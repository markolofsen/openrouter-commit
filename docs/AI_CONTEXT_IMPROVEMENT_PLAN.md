# AI Context Improvement Plan

**Ğ”Ğ°Ñ‚Ğ°:** 2025-12-13
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** Ğ’ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ
**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹

## ğŸ“‹ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ

1. [ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹](#Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·-Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹)
2. [ĞšĞ¾Ñ€Ğ½ĞµĞ²Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹](#ĞºĞ¾Ñ€Ğ½ĞµĞ²Ñ‹Ğµ-Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹)
3. [ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ğ¾Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ](#Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ğ¾Ğµ-Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ)
4. [ĞŸĞ»Ğ°Ğ½ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸](#Ğ¿Ğ»Ğ°Ğ½-Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸)
5. [Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸](#Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ-Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸)
6. [Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ](#Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)

---

## ğŸ” ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹

### Ğ¡Ğ¸Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼Ñ‹

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° 1: ĞĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğµ commit messages**
```
Ğ¡Ğ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ñ: ĞšĞ¾Ğ¼Ğ¼Ğ¸Ñ‚ Ñ 465 Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼Ğ¸
AI Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ğ»: "refactor(authentication): migrate from session-based to JWT authentication"
Ğ ĞµĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ: Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ½Ğµ ÑĞ²ÑĞ·Ğ°Ğ½Ñ‹ Ñ JWT/auth Ğ²Ğ¾Ğ¾Ğ±Ñ‰Ğµ
```

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° 2: "No relevant changes found"**
```
Ğ¡Ğ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ñ: ĞšĞ¾Ğ¼Ğ¼Ğ¸Ñ‚ Ñ 2 Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼Ğ¸ (Makefile, package.json)
Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: "All changes were filtered out"
Ğ ĞµĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ: Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ±Ñ‹Ğ»Ğ¸ Ğ²Ğ°Ğ¶Ğ½Ñ‹Ğ¼Ğ¸, Ğ½Ğ¾ Ğ¾Ñ‚Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ¸ÑÑŒ
```

### ĞĞ°Ğ±Ğ»ÑĞ´ĞµĞ½Ğ¸Ñ

1. AI Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ commit messages Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ **Ñ‡Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°**
2. Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¸Ğµ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ñ‹ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒÑÑ‚ÑÑ Ğ°Ğ³Ñ€ĞµÑÑĞ¸Ğ²Ğ½Ğ¾
3. AI "Ğ´Ğ¾Ğ³Ğ°Ğ´Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ" Ğ¾ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğ¼ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹
4. Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ‚ĞµÑ€ÑĞµÑ‚ 90-95% ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° Ğ¸Ğ·-Ğ·Ğ° Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ñ… Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²

---

## ğŸš¨ ĞšĞ¾Ñ€Ğ½ĞµĞ²Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹

### ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° #1: Ğ–ĞµÑÑ‚ĞºĞ¸Ğ¹ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ 20 ÑÑ‚Ñ€Ğ¾Ğº

**Ğ¤Ğ°Ğ¹Ğ»:** `src/modules/core.ts:637`

```typescript
const relevantLines = chunk.lines
  .filter(line => line.type === 'added' || line.type === 'removed')
  .slice(0, 20) // âŒ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ: AI Ğ²Ğ¸Ğ´Ğ¸Ñ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿ĞµÑ€Ğ²Ñ‹Ğµ 20 ÑÑ‚Ñ€Ğ¾Ğº Ğ¸Ğ· ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ chunk!
  .map(line => `${line.type === 'added' ? '+' : '-'}${line.content}`)
  .join('\n');
```

**ĞŸĞ¾ÑĞ»ĞµĞ´ÑÑ‚Ğ²Ğ¸Ñ:**
- Ğ¤Ğ°Ğ¹Ğ» Ñ 500 Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸ÑĞ¼Ğ¸ â†’ AI Ğ²Ğ¸Ğ´Ğ¸Ñ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ 20 Ğ¿ĞµÑ€Ğ²Ñ‹Ñ… ÑÑ‚Ñ€Ğ¾Ğº
- Ğ¢ĞµÑ€ÑĞµÑ‚ÑÑ 96% ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° (480 ÑÑ‚Ñ€Ğ¾Ğº Ğ¸Ğ· 500)
- AI Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ğ¾Ğ½ÑÑ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ½ÑƒÑ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½Ñƒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹
- Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒÑÑ‚ÑÑ Ğ½ĞµÑ‚Ğ¾Ñ‡Ğ½Ñ‹Ğµ commit messages

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```
Ğ ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»:
  Lines 1-20:   import statements, setup
  Lines 21-500: Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°, Ğ½Ğ¾Ğ²Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸, bug fixes

AI Ğ²Ğ¸Ğ´Ğ¸Ñ‚:
  Lines 1-20:   import statements, setup
  Lines 21-500: âŒ ĞĞ•Ğ’Ğ˜Ğ”Ğ˜ĞœĞ

Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: AI Ğ´ÑƒĞ¼Ğ°ĞµÑ‚ Ñ‡Ñ‚Ğ¾ ÑÑ‚Ğ¾ "refactor imports"
```

---

### ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° #2: ĞĞ³Ñ€ĞµÑÑĞ¸Ğ²Ğ½Ğ°Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ

**Ğ¤Ğ°Ğ¹Ğ»:** `src/modules/diff-filter.ts:209-212`

```typescript
const relevantFiles = scoredFiles
  .filter(scored => scored.score >= opts.relevancyThreshold) // threshold = 0.1
  .sort((a, b) => b.score - a.score)
```

**Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¾Ñ†ĞµĞ½ĞºĞ¸:**
- Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ score: 0.1 (Ğ·Ğ° ÑĞ°Ğ¼ Ñ„Ğ°ĞºÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹)
- Ğ¢Ğ¸Ğ¿ Ñ„Ğ°Ğ¹Ğ»Ğ°: +0.1-0.4 (source code Ğ»ÑƒÑ‡ÑˆĞµ, docs Ñ…ÑƒĞ¶Ğµ)
- ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ ĞºĞ¾Ğ´Ğ°: +0.2-0.3 (Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸, error handling, etc.)
- Ğ¨Ñ‚Ñ€Ğ°Ñ„ Ğ·Ğ° Ñ€Ğ°Ğ·Ğ¼ĞµÑ€: Ã—0.7 Ğ´Ğ»Ñ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² >500 ÑÑ‚Ñ€Ğ¾Ğº

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:**
1. **Threshold = 0.1 ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹** Ğ´Ğ»Ñ Ğ½ĞµĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… Ñ‚Ğ¸Ğ¿Ğ¾Ğ² Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
   ```
   Makefile: base(0.1) + type(0) = 0.1 â†’ Ğ½Ğ° Ğ³Ñ€Ğ°Ğ½Ğ¸ Ğ¾Ñ‚ÑĞµÑ‡ĞµĞ½Ğ¸Ñ
   package.json: base(0.1) + type(0.25) = 0.35 â†’ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¸Ñ‚
   docs/README.md: base(0.1) + type(0.15) = 0.25 â†’ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¸Ñ‚

   ĞĞ¾ ĞµÑĞ»Ğ¸ Ñ„Ğ°Ğ¹Ğ» ĞµÑ‰Ğµ Ğ¸ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ (>500 ÑÑ‚Ñ€Ğ¾Ğº):
   Makefile (600 ÑÑ‚Ñ€Ğ¾Ğº): 0.1 Ã— 0.7 = 0.07 â†’ âŒ ĞĞ¢Ğ¤Ğ˜Ğ›Ğ¬Ğ¢Ğ ĞĞ’ĞĞ!
   ```

2. **Hardcoded Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ½Ğµ Ğ¿Ğ¾ĞºÑ€Ñ‹Ğ²Ğ°ÑÑ‚ Ğ²ÑĞµ ÑĞ»ÑƒÑ‡Ğ°Ğ¸**
   ```typescript
   // Ğ­Ñ‚Ğ¸ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ÑÑ‚ Ğ±Ğ¾Ğ½ÑƒÑÑ‹:
   /function|def|class|interface/  // +0.3
   /error|exception|catch|throw/   // +0.2
   /password|token|key|auth/       // +0.2

   // ĞĞ¾ Ñ‡Ñ‚Ğ¾ ĞµÑĞ»Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ²:
   - Business logic Ğ±ĞµĞ· Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹?
   - Refactoring ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾ ĞºĞ¾Ğ´Ğ°?
   - Configuration changes?
   â†’ ĞœĞ¾Ğ³ÑƒÑ‚ Ğ½Ğµ Ğ½Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ±Ğ°Ğ»Ğ»Ğ¾Ğ²!
   ```

3. **Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ "formatter noise" ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ°Ğ³Ñ€ĞµÑÑĞ¸Ğ²Ğ½Ğ°**
   ```typescript
   // Ğ­Ñ‚Ğ¸ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ğ¾Ñ‚Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ:
   /^import\s+/          // Ğ’ÑĞµ imports
   /^from\s+.*import/    // Ğ’ÑĞµ from-imports
   /,\s*$/               // Trailing commas
   /;\s*$/               // Semicolons
   /^["']/               // Quote changes

   // ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: Ğ¸Ğ½Ğ¾Ğ³Ğ´Ğ° import changes Ğ²Ğ°Ğ¶Ğ½Ñ‹!
   // ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
   import { newFeature } from 'new-library'; // âŒ Ğ¾Ñ‚Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ ĞºĞ°Ğº noise
   ```

**ĞŸĞ¾ÑĞ»ĞµĞ´ÑÑ‚Ğ²Ğ¸Ñ:**
- Ğ’Ğ°Ğ¶Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ¾Ñ‚Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ
- AI Ğ½Ğµ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ
- Ğ¢ĞµÑ€ÑĞµÑ‚ÑÑ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹

---

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° #3: ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²Ğ¸Ğµ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

**Ğ§Ñ‚Ğ¾ Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚:**
1. **Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ¾Ğ²** - AI Ğ½Ğµ Ğ·Ğ½Ğ°ĞµÑ‚ Ñ‡Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ğ»Ğ¾ Ñ€Ğ°Ğ½ĞµĞµ
2. **Ğ¡Ñ‚Ğ¸Ğ»ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°** - AI Ğ½Ğµ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ commit messages
3. **Ğ¡Ğ²ÑĞ·ÑŒ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸ÑĞ¼Ğ¸** - AI Ğ½Ğµ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ ĞºĞ°Ğº Ñ„Ğ°Ğ¹Ğ»Ñ‹ ÑĞ²ÑĞ·Ğ°Ğ½Ñ‹

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```
Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ¾Ğ²:
  abc123 feat: add JWT authentication endpoint
  def456 feat: implement token refresh logic
  ghi789 refactor: move auth to separate service

Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚:
  - Update auth tests
  - Fix token expiration bug

AI Ğ±ĞµĞ· ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° Ğ´ÑƒĞ¼Ğ°ĞµÑ‚:
  "fix: update tests"

AI Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼ Ğ¿Ğ¾Ğ½ÑĞ» Ğ±Ñ‹:
  "fix(auth): fix token expiration in JWT refresh flow"
```

---

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° #4: Ğ–ĞµÑÑ‚ĞºĞ¸Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ±ĞµĞ· Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸

**Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğµ hardcoded Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ:**
```typescript
// diff-filter.ts
relevancyThreshold: 0.1,        // ĞĞµĞ»ÑŒĞ·Ñ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ
maxFileSize: 1024 * 1024,       // 1MB - Ğ½ĞµĞ»ÑŒĞ·Ñ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ

// core.ts
.slice(0, 20)                   // ĞĞµĞ»ÑŒĞ·Ñ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ
maxChunkSize: 100000,           // ĞĞµĞ»ÑŒĞ·Ñ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ
```

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:**
- Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ñ‹ Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‚ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº
- ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ´ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºÑƒ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ
- ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ

---

## ğŸ’¡ ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ğ¾Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ

### Ğ“Ğ¸Ğ±Ñ€Ğ¸Ğ´Ğ½Ñ‹Ğ¹ Ğ´Ğ²ÑƒÑ…ÑÑ‚Ğ°Ğ¿Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ Ñ AI File Selection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ­Ğ¢ĞĞŸ 0: Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ ÑĞ²Ñ€Ğ¸ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ               â”‚
â”‚  â”œâ”€ Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ binary files                                 â”‚
â”‚  â”œâ”€ Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ lock files                                   â”‚
â”‚  â”œâ”€ Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ node_modules, vendor, etc.                   â”‚
â”‚  â””â”€ Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¾Ñ‡ĞµĞ²Ğ¸Ğ´Ğ½Ğ¾ generated ĞºĞ¾Ğ´                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ£Ğ¡Ğ›ĞĞ’Ğ˜Ğ•: Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²?                               â”‚
â”‚  â”œâ”€ < 20 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²:  â†’ ĞŸÑ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ AI selection            â”‚
â”‚  â”œâ”€ 20-150 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²: â†’ Ğ­Ğ¢ĞĞŸ 1 (AI selection)             â”‚
â”‚  â””â”€ > 150 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²:  â†’ Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ğ°Ñ ÑĞ²Ñ€Ğ¸ÑÑ‚Ğ¸ĞºĞ°              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ­Ğ¢ĞĞŸ 1: AI File Selection (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ 20-150 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²)  â”‚
â”‚  â”œâ”€ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ preview ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°:                     â”‚
â”‚  â”‚   â€¢ Path, status, size, language                    â”‚
â”‚  â”‚   â€¢ First 30-50 lines of changes (Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ¾)        â”‚
â”‚  â”‚   â€¢ Priority level (high/medium/low)                â”‚
â”‚  â”œâ”€ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² AI (Ğ±Ñ‹ÑÑ‚Ñ€ÑƒÑ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ, Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Haiku)    â”‚
â”‚  â””â”€ AI Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ TOP-N ÑĞ°Ğ¼Ñ‹Ñ… Ğ²Ğ°Ğ¶Ğ½Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ­Ğ¢ĞĞŸ 2: ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ñ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸ÑĞ¼Ğ¸                   â”‚
â”‚  â”œâ”€ ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ ÑÑ‚Ñ€Ğ¾Ğº (Ğ½Ğµ 20, Ğ° 50-200!)         â”‚
â”‚  â”œâ”€ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ git history (Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 5 ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ¾Ğ²)       â”‚
â”‚  â”œâ”€ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°                          â”‚
â”‚  â””â”€ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ commit message                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ ĞŸĞ»Ğ°Ğ½ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### Phase 1: ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ (Ğ”ĞµĞ½ÑŒ 1)

**Ğ¦ĞµĞ»ÑŒ:** ĞĞµĞ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ ÑƒĞ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑŒ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ±ĞµĞ· breaking changes

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸:**

1. **Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¶ĞµÑÑ‚ĞºĞ¸Ğ¹ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ 20 ÑÑ‚Ñ€Ğ¾Ğº**
   - Ğ¤Ğ°Ğ¹Ğ»: `src/modules/core.ts:637`
   - Ğ‘Ñ‹Ğ»Ğ¾: `.slice(0, 20)`
   - Ğ¡Ñ‚Ğ°Ğ½ĞµÑ‚: `.slice(0, this.getAdaptiveLineLimit(file, totalFiles))`

   ```typescript
   private getAdaptiveLineLimit(file: GitFile, totalFiles: number): number {
     if (totalFiles <= 5) return 200;   // ĞœĞ°Ğ»Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚ - Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ²ÑĞµ
     if (totalFiles <= 20) return 100;  // Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ - 100 ÑÑ‚Ñ€Ğ¾Ğº
     if (totalFiles <= 50) return 50;   // Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ - 50 ÑÑ‚Ñ€Ğ¾Ğº
     return 30;                          // ĞĞ³Ñ€Ğ¾Ğ¼Ğ½Ñ‹Ğ¹ - Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 30
   }
   ```

2. **ĞŸĞ¾Ğ½Ğ¸Ğ·Ğ¸Ñ‚ÑŒ relevancy threshold**
   - Ğ¤Ğ°Ğ¹Ğ»: `src/modules/core.ts:118`, `src/modules/diff-filter.ts:26`
   - Ğ‘Ñ‹Ğ»Ğ¾: `relevancyThreshold: 0.1`
   - Ğ¡Ñ‚Ğ°Ğ½ĞµÑ‚: `relevancyThreshold: 0.05`

3. **Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ quickFilter Ğ´Ğ»Ñ Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğ¹ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸**
   - Ğ¤Ğ°Ğ¹Ğ»: `src/modules/diff-filter.ts`
   - ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¼ĞµÑ‚Ğ¾Ğ´: `quickFilter(files: GitFile[]): GitFile[]`
   - Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ñ‡ĞµĞ²Ğ¸Ğ´Ğ½Ñ‹Ğ¹ Ğ¼ÑƒÑĞ¾Ñ€ (binary, locks, node_modules)

**ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:**
- AI Ğ±ÑƒĞ´ĞµÑ‚ Ğ²Ğ¸Ğ´ĞµÑ‚ÑŒ Ğ² 2-10 Ñ€Ğ°Ğ· Ğ±Ğ¾Ğ»ÑŒÑˆĞµ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°
- ĞœĞµĞ½ÑŒÑˆĞµ Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ñ… ÑÑ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğ¹ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°
- Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ÑÑ€Ğ°Ğ·Ñƒ Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸

---

### Phase 2: AI File Selector (Ğ”Ğ½Ğ¸ 2-3)

**Ğ¦ĞµĞ»ÑŒ:** Ğ˜Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°:**

```typescript
// src/modules/file-selector.ts

interface FilePreview {
  path: string;
  status: GitFileStatus;
  size: number;              // lines changed
  language: string;          // detected language
  priority: 'high' | 'medium' | 'low';
  preview: string;           // first N lines of changes
}

interface AIFileSelectionResult {
  selectedFiles: string[];   // paths
  reasoning?: string;        // Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾: Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ñ‹
  confidence: number;        // 0-1: ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ AI
}

class AIFileSelector {
  constructor(private config: Config) {}

  /**
   * Main entry point for file selection
   */
  async selectRelevantFiles(
    files: GitFile[],
    maxFiles: number = 30
  ): Promise<GitFile[]> {

    // 1. Quick filter
    const filtered = this.quickFilter(files);

    // 2. Decide if AI selection needed
    if (filtered.length <= 20) {
      return filtered; // Too few files - use all
    }

    if (filtered.length > 150) {
      return this.heuristicSelection(filtered, maxFiles);
    }

    // 3. AI selection for 20-150 files
    const previews = this.createPreviews(filtered);
    const result = await this.askAI(previews, maxFiles);

    return files.filter(f => result.selectedFiles.includes(f.path));
  }

  /**
   * Remove obvious non-code files
   */
  private quickFilter(files: GitFile[]): GitFile[] {
    return files.filter(file => {
      // Binary files
      if (file.isBinary) return false;

      // Lock files
      if (/\.(lock|sum)$/.test(file.path)) return false;

      // Package manager directories
      if (/node_modules|vendor|bower_components/.test(file.path)) {
        return false;
      }

      // Build outputs
      if (/dist\/|build\/|out\/|\.next\/|\.nuxt\//.test(file.path)) {
        return false;
      }

      // Cache and temp
      if (/\.cache\/|tmp\/|temp\//.test(file.path)) {
        return false;
      }

      return true;
    });
  }

  /**
   * Create file previews with smart sizing
   */
  private createPreviews(files: GitFile[]): FilePreview[] {
    return files.map(file => {
      const priority = this.calculatePriority(file);
      const changedLines = this.getChangedLines(file);

      // Adaptive preview size based on priority
      const previewSize = priority === 'high' ? 50 :
                          priority === 'medium' ? 30 : 20;

      return {
        path: file.path,
        status: file.status,
        size: changedLines.length,
        language: this.detectLanguage(file.path),
        priority,
        preview: changedLines.slice(0, previewSize).join('\n')
      };
    });
  }

  /**
   * Calculate file priority
   */
  private calculatePriority(file: GitFile): 'high' | 'medium' | 'low' {
    const path = file.path.toLowerCase();

    // High priority: source code
    if (/\.(ts|tsx|js|jsx|py|rb|php|java|go|rs|cpp|c|h)$/.test(path)) {
      return 'high';
    }

    // Medium priority: configs, schemas
    if (/\.(json|yaml|yml|toml|sql|graphql|prisma)$/.test(path)) {
      return 'medium';
    }

    // Low priority: docs, styles
    if (/\.(md|txt|css|scss|html)$/.test(path)) {
      return 'low';
    }

    return 'medium'; // default
  }

  /**
   * Get all changed lines from file
   */
  private getChangedLines(file: GitFile): string[] {
    const lines: string[] = [];

    for (const chunk of file.chunks) {
      for (const line of chunk.lines) {
        if (line.type === 'added' || line.type === 'removed') {
          const prefix = line.type === 'added' ? '+' : '-';
          lines.push(`${prefix} ${line.content}`);
        }
      }
    }

    return lines;
  }

  /**
   * Detect programming language
   */
  private detectLanguage(path: string): string {
    const ext = path.split('.').pop()?.toLowerCase();

    const langMap: Record<string, string> = {
      'ts': 'TypeScript',
      'tsx': 'TypeScript React',
      'js': 'JavaScript',
      'jsx': 'JavaScript React',
      'py': 'Python',
      'rb': 'Ruby',
      'php': 'PHP',
      'java': 'Java',
      'go': 'Go',
      'rs': 'Rust',
      'cpp': 'C++',
      'c': 'C',
      'cs': 'C#',
      'sql': 'SQL',
      'graphql': 'GraphQL',
    };

    return ext ? (langMap[ext] || ext.toUpperCase()) : 'Unknown';
  }

  /**
   * Ask AI to select files
   */
  private async askAI(
    previews: FilePreview[],
    maxFiles: number
  ): Promise<AIFileSelectionResult> {

    const prompt = this.buildSelectionPrompt(previews, maxFiles);

    try {
      const response = await apiManager.generateCommitMessage({
        provider: this.config.preferences.defaultProvider,
        model: this.getSelectionModel(),
        messages: [{ role: 'user', content: prompt }],
        maxTokens: 2000,
        temperature: 0.3, // Low temperature for consistent selection
      }, this.config.preferences.defaultProvider);

      if (!response.success || !response.data) {
        throw new Error('AI selection failed');
      }

      return this.parseAIResponse(response.data);

    } catch (error) {
      logger.warn('AI file selection failed, falling back to heuristic');
      return {
        selectedFiles: this.heuristicSelection(
          previews.map(p => ({ path: p.path }) as GitFile),
          maxFiles
        ).map(f => f.path),
        confidence: 0.5,
      };
    }
  }

  /**
   * Build prompt for AI file selection
   */
  private buildSelectionPrompt(
    previews: FilePreview[],
    maxFiles: number
  ): string {

    const filesList = previews.map((p, i) => `
[${i + 1}] ${p.path}
   Status: ${p.status} | Size: ${p.size} lines | Language: ${p.language} | Priority: ${p.priority}
   Preview:
${p.preview.split('\n').map(l => '   ' + l).join('\n')}
---`).join('\n');

    return `You are analyzing a git commit with ${previews.length} changed files.

YOUR TASK: Select the TOP ${maxFiles} most important files needed to write an accurate, comprehensive commit message.

SELECTION CRITERIA:
1. **Core changes**: Files that represent the main purpose of this commit
2. **Source code priority**: Prefer actual code over configs/docs (unless config IS the main change)
3. **Avoid redundancy**: If 10 test files test the same feature, pick 2-3 representative ones
4. **Context matters**: Include files that provide context for understanding the changes
5. **Watch for patterns**:
   - New files (added) are often important
   - Deleted files may indicate major refactoring
   - Modified core modules are usually critical

FILES TO ANALYZE:
${filesList}

RESPONSE FORMAT (JSON only):
{
  "selectedFiles": ["path/to/file1.ts", "path/to/file2.ts", ...],
  "reasoning": "Brief explanation of selection strategy",
  "confidence": 0.85
}

Return ONLY valid JSON, no markdown, no explanations outside JSON.`;
  }

  /**
   * Parse AI response
   */
  private parseAIResponse(response: string): AIFileSelectionResult {
    try {
      // Remove markdown code blocks if present
      let cleaned = response.trim();
      const match = cleaned.match(/```(?:json)?\s*(\{[\s\S]*?\})\s*```/);
      if (match) {
        cleaned = match[1] || cleaned;
      }

      const parsed = JSON.parse(cleaned);

      return {
        selectedFiles: parsed.selectedFiles || [],
        reasoning: parsed.reasoning,
        confidence: parsed.confidence || 0.5,
      };

    } catch (error) {
      logger.error('Failed to parse AI selection response', error as Error);
      throw new Error('Invalid AI response format');
    }
  }

  /**
   * Fallback heuristic selection
   */
  private heuristicSelection(files: GitFile[], maxFiles: number): GitFile[] {
    // Sort by priority: source code > configs > docs
    const scored = files.map(file => ({
      file,
      score: this.calculateFileScore(file),
    }));

    scored.sort((a, b) => b.score - a.score);

    return scored.slice(0, maxFiles).map(s => s.file);
  }

  /**
   * Calculate simple numeric score for heuristic sorting
   */
  private calculateFileScore(file: GitFile): number {
    let score = 0;
    const path = file.path.toLowerCase();

    // Priority by file type
    if (/\.(ts|tsx|js|jsx|py|rb|java|go)$/.test(path)) {
      score += 100; // Source code
    } else if (/\.(json|yaml|yml|toml)$/.test(path)) {
      score += 50; // Config
    } else if (/\.(md|txt)$/.test(path)) {
      score += 20; // Docs
    }

    // Boost for new/deleted files
    if (file.status === 'added') score += 30;
    if (file.status === 'deleted') score += 20;

    // Boost for core directories
    if (/^src\//.test(path)) score += 20;
    if (/^lib\//.test(path)) score += 15;

    // Penalize test files (unless that's the main change)
    if (/\.(test|spec)\.(ts|js|py)$/.test(path)) score -= 10;

    return score;
  }

  /**
   * Get model for file selection (cheaper, faster model)
   */
  private getSelectionModel(): string {
    const provider = this.config.preferences.defaultProvider;

    // Use cheaper models for file selection
    if (provider === 'openrouter') {
      return 'anthropic/claude-3-haiku:beta';
    } else {
      return 'gpt-3.5-turbo';
    }
  }
}

export const fileSelector = new AIFileSelector(configManager.getConfig());
```

**Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ² core.ts:**

```typescript
// src/modules/core.ts

async generateCommit(options: CliOptions): Promise<void> {
  // ... existing code ...

  // Phase 2: Filter and process
  const filterProgress = contextualLogger.startProgress('Processing changes');

  // Quick filter first
  let diff = diffFilter.quickFilter(rawDiff);
  filterProgress.update(`Quick filter: ${diff.files.length} files remaining`);

  // AI file selection if needed
  if (this.shouldUseAISelection(diff.files.length)) {
    filterProgress.update('AI analyzing file relevance...');

    const maxFiles = options.maxFiles || this.config.generation.maxFilesForAnalysis;
    diff.files = await fileSelector.selectRelevantFiles(diff.files, maxFiles);

    filterProgress.succeed(`AI selected ${diff.files.length} most relevant files`);
  } else {
    // Traditional filtering for small/large commits
    diff = diffFilter.filterDiff(diff, {
      ignoreGenerated: options.ignoreGenerated,
      ignoreWhitespace: options.ignoreWhitespace,
      relevancyThreshold: this.config.generation.relevancyThreshold,
    });

    filterProgress.succeed(`Filtered to ${diff.files.length} relevant files`);
  }

  // ... rest of the code ...
}

private shouldUseAISelection(fileCount: number): boolean {
  if (!this.config.generation.enableAIFileSelection) {
    return false;
  }

  const threshold = this.config.generation.aiSelectionThreshold;
  const maxForAI = 150; // Don't use AI for huge commits (too slow)

  return fileCount >= threshold && fileCount <= maxForAI;
}
```

---

### Phase 3: Git Context (Ğ”ĞµĞ½ÑŒ 4)

**Ğ¦ĞµĞ»ÑŒ:** Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ»Ñ Ğ»ÑƒÑ‡ÑˆĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ

**Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:**

```typescript
// src/modules/git.ts

/**
 * Get recent commit history for context
 */
async getCommitHistory(depth: number = 5): Promise<string[]> {
  try {
    const { stdout } = await execAsync(
      `git log -${depth} --oneline --no-decorate`,
      EXEC_OPTIONS
    );

    return stdout
      .trim()
      .split('\n')
      .filter(line => line.trim().length > 0);

  } catch (error) {
    logger.warn('Failed to get commit history', error as Error);
    return [];
  }
}

/**
 * Get current branch name
 */
async getCurrentBranch(): Promise<string> {
  // ... existing code ...
}

/**
 * Format git context for AI
 */
async getGitContextForAI(): Promise<string> {
  const history = await this.getCommitHistory(5);
  const branch = await this.getCurrentBranch();

  if (history.length === 0) {
    return '';
  }

  return `
[GIT_CONTEXT]
Current branch: ${branch}

Recent commits (for context and style reference):
${history.map((line, i) => `${i + 1}. ${line}`).join('\n')}

Note: Use similar commit message style as above.
[/GIT_CONTEXT]
`;
}
```

**Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ² core.ts:**

```typescript
// src/modules/core.ts

private async generateCommitMessage(
  diff: GitDiff,
  options: CliOptions,
  provider: 'openrouter' | 'openai',
  userFeedback?: string
): Promise<{ commitMessage: string; assessment: string | null }> {

  // ... existing code ...

  // Prepare diff content
  const rawDiffContent = this.prepareDiffContent(diff);
  let diffContent = wrapDiffContent(rawDiffContent);

  // Add git context if enabled
  if (this.config.generation.includeGitHistory) {
    const gitContext = await gitManager.getGitContextForAI();
    if (gitContext) {
      diffContent = gitContext + '\n\n' + diffContent;
    }
  }

  // ... rest of the code ...
}
```

---

### Phase 4: Configuration (Ğ”ĞµĞ½ÑŒ 5)

**Ğ¦ĞµĞ»ÑŒ:** Ğ”Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ½Ğ°Ğ´ Ğ²ÑĞµĞ¼Ğ¸ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ°Ğ¼Ğ¸

**ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¸Ğ¿Ğ¾Ğ²:**

```typescript
// src/types/index.ts

export interface CommitGenerationConfig {
  // AI File Selection
  enableAIFileSelection: boolean;      // default: true
  aiSelectionThreshold: number;        // files count to trigger (default: 20)
  maxFilesForAnalysis: number;         // max files to analyze (default: 30)

  // Line limits
  maxLinesPerChunk: number;            // default: 100 (was 20!)
  adaptiveLineLimits: boolean;         // default: true
  smallCommitLineLimit: number;        // default: 200 (for <=5 files)
  mediumCommitLineLimit: number;       // default: 100 (for <=20 files)
  largeCommitLineLimit: number;        // default: 50 (for <=50 files)
  hugeCommitLineLimit: number;         // default: 30 (for >50 files)

  // Git context
  includeGitHistory: boolean;          // default: true
  gitHistoryDepth: number;             // default: 5 commits

  // Filtering
  relevancyThreshold: number;          // default: 0.05 (was 0.1)
  aggressiveFilteringThreshold: number; // files count (default: 100)

  // Performance
  maxConcurrentRequests: number;       // default: 3
  enableCaching: boolean;              // default: true
}

export interface Config {
  version: string;
  providers: {
    openrouter: ProviderConfig;
    openai: ProviderConfig;
  };
  preferences: PreferencesConfig;
  generation: CommitGenerationConfig;  // NEW!
}
```

**Defaults:**

```typescript
// src/modules/config.ts

const DEFAULT_GENERATION_CONFIG: CommitGenerationConfig = {
  // AI File Selection
  enableAIFileSelection: true,
  aiSelectionThreshold: 20,
  maxFilesForAnalysis: 30,

  // Line limits
  maxLinesPerChunk: 100,
  adaptiveLineLimits: true,
  smallCommitLineLimit: 200,
  mediumCommitLineLimit: 100,
  largeCommitLineLimit: 50,
  hugeCommitLineLimit: 30,

  // Git context
  includeGitHistory: true,
  gitHistoryDepth: 5,

  // Filtering
  relevancyThreshold: 0.05,
  aggressiveFilteringThreshold: 100,

  // Performance
  maxConcurrentRequests: 3,
  enableCaching: true,
};
```

**CLI Commands:**

```typescript
// src/cli.ts

// New commands for generation config
program
  .command('config:generation')
  .description('Configure commit generation settings')
  .action(async () => {
    // Interactive prompts to configure generation settings
  });

program
  .command('config:generation:reset')
  .description('Reset generation settings to defaults')
  .action(async () => {
    await configManager.resetGenerationConfig();
  });

program
  .command('config:generation:show')
  .description('Show current generation settings')
  .action(async () => {
    const config = await configManager.load();
    console.log(config.generation);
  });
```

---

### Phase 5: Testing & Validation (Ğ”Ğ½Ğ¸ 6-7)

**Test Cases:**

```typescript
// tests/file-selector.test.ts

describe('AIFileSelector', () => {

  test('should use all files for small commits (<20)', async () => {
    const files = generateMockFiles(10);
    const result = await fileSelector.selectRelevantFiles(files);
    expect(result.length).toBe(10);
  });

  test('should use AI selection for medium commits (20-150)', async () => {
    const files = generateMockFiles(50);
    const result = await fileSelector.selectRelevantFiles(files, 30);
    expect(result.length).toBeLessThanOrEqual(30);
  });

  test('should use heuristic for large commits (>150)', async () => {
    const files = generateMockFiles(200);
    const result = await fileSelector.selectRelevantFiles(files, 30);
    expect(result.length).toBeLessThanOrEqual(30);
  });

  test('quickFilter should remove binary files', () => {
    const files = [
      { path: 'src/index.ts', isBinary: false },
      { path: 'image.png', isBinary: true },
    ];
    const result = fileSelector.quickFilter(files);
    expect(result.length).toBe(1);
    expect(result[0].path).toBe('src/index.ts');
  });

  test('should calculate correct priority', () => {
    expect(fileSelector.calculatePriority({ path: 'src/main.ts' })).toBe('high');
    expect(fileSelector.calculatePriority({ path: 'config.json' })).toBe('medium');
    expect(fileSelector.calculatePriority({ path: 'README.md' })).toBe('low');
  });

});
```

```typescript
// tests/adaptive-limits.test.ts

describe('Adaptive Line Limits', () => {

  test('small commit should use high limit', () => {
    const limit = core.getAdaptiveLineLimit(mockFile, 5);
    expect(limit).toBe(200);
  });

  test('medium commit should use medium limit', () => {
    const limit = core.getAdaptiveLineLimit(mockFile, 20);
    expect(limit).toBe(100);
  });

  test('large commit should use low limit', () => {
    const limit = core.getAdaptiveLineLimit(mockFile, 100);
    expect(limit).toBe(30);
  });

});
```

**Integration Tests:**

```bash
# Test scenarios

# Scenario 1: Small commit (2 files)
git add Makefile package.json
orc commit
# Expected: Use all files, no filtering, high line limit

# Scenario 2: Medium commit (30 files)
git add src/**/*.ts
orc commit
# Expected: AI file selection, select ~20-30 files, medium line limit

# Scenario 3: Large commit (100+ files)
git add .
orc commit
# Expected: Heuristic filtering, top 30-50 files, low line limit

# Scenario 4: With git context
orc commit --include-history
# Expected: Git history included in prompt

# Scenario 5: Disable AI selection
orc config:generation set enableAIFileSelection false
orc commit
# Expected: Use traditional filtering only
```

---

## ğŸ“Š ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ñ‹Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ

### ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ°:

**Ğ”Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹:**
```
Ğ¢ĞµÑÑ‚ 1: 465 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
  Context seen by AI: ~2,000 lines (5% Ğ¸Ğ· 40,000)
  Result: "refactor(authentication): migrate to JWT" âŒ ĞĞµĞ²ĞµÑ€Ğ½Ğ¾

Ğ¢ĞµÑÑ‚ 2: 2 Ñ„Ğ°Ğ¹Ğ»Ğ° (Makefile, package.json)
  Context seen by AI: 0 lines (Ğ¾Ñ‚Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾)
  Result: "No relevant changes found" âŒ ĞĞµĞ²ĞµÑ€Ğ½Ğ¾
```

**ĞŸĞ¾ÑĞ»Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹:**
```
Ğ¢ĞµÑÑ‚ 1: 465 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
  Quick filter: 465 â†’ 300 files
  Heuristic: 300 â†’ 50 top files
  Context seen by AI: ~5,000 lines (100 per file Ã— 50)
  Result: Accurate commit message based on real changes âœ…

Ğ¢ĞµÑÑ‚ 2: 2 Ñ„Ğ°Ğ¹Ğ»Ğ°
  Quick filter: 2 files (pass through)
  No AI selection needed
  Context seen by AI: ~400 lines (200 per file)
  Result: Accurate commit message âœ…
```

### Performance:

**Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹:**
```
Small commit (5 files):   ~5 seconds
Medium commit (30 files): ~8 seconds
Large commit (100 files): ~15 seconds (Ñ‡Ğ°ÑÑ‚Ğ¾ Ğ½ĞµÑ‚Ğ¾Ñ‡Ğ½Ñ‹Ğ¹)
```

**ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ñ‹Ğ¹:**
```
Small commit (5 files):   ~5 seconds (Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹)
Medium commit (30 files): ~12 seconds (+4s Ğ·Ğ° AI selection, Ğ½Ğ¾ Ñ‚Ğ¾Ñ‡Ğ½ĞµĞµ!)
Large commit (100 files): ~10 seconds (Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ Ğ·Ğ° ÑÑ‡ĞµÑ‚ Ğ»ÑƒÑ‡ÑˆĞµĞ¹ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸)
```

### Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ:

**Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ·Ğ°Ñ‚Ñ€Ğ°Ñ‚Ñ‹ Ğ½Ğ° AI File Selection:**
```
ĞœĞ¾Ğ´ĞµĞ»ÑŒ: Claude Haiku / GPT-3.5 Turbo (Ğ´ĞµÑˆĞµĞ²Ñ‹Ğµ)
Tokens per request: ~2,000-4,000 (previews)
Cost per request: ~$0.001-0.002
Frequency: Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ¾Ğ² 20-150 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² (~30% ÑĞ»ÑƒÑ‡Ğ°ĞµĞ²)

Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€Ğ¾ÑÑ‚ ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸: ~$0.002 per commit (Ñ AI selection)
Benefit: Ğ—Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ±Ğ¾Ğ»ĞµĞµ Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğµ commit messages
```

---

## ğŸ›ï¸ ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

### Ğ¤Ğ°Ğ¹Ğ» ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸:

**~/.orc/config.json:**
```json
{
  "version": "2.0.0",
  "providers": { ... },
  "preferences": { ... },
  "generation": {
    "enableAIFileSelection": true,
    "aiSelectionThreshold": 20,
    "maxFilesForAnalysis": 30,
    "maxLinesPerChunk": 100,
    "adaptiveLineLimits": true,
    "smallCommitLineLimit": 200,
    "mediumCommitLineLimit": 100,
    "largeCommitLineLimit": 50,
    "hugeCommitLineLimit": 30,
    "includeGitHistory": true,
    "gitHistoryDepth": 5,
    "relevancyThreshold": 0.05,
    "aggressiveFilteringThreshold": 100,
    "maxConcurrentRequests": 3,
    "enableCaching": true
  }
}
```

### CLI ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ:

```bash
# ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
orc config:generation:show

# ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾
orc config:generation

# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ
orc config:generation set enableAIFileSelection true
orc config:generation set maxFilesForAnalysis 50
orc config:generation set includeGitHistory true

# Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğº defaults
orc config:generation:reset

# Disable AI selection (faster, but less accurate)
orc config:generation set enableAIFileSelection false
```

---

## ğŸ”„ Migration Path

### ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ:

1. **Ğ¡Ñ‚Ğ°Ñ€Ñ‹Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚** - ĞµÑĞ»Ğ¸ `generation` ÑĞµĞºÑ†Ğ¸Ğ¸ Ğ½ĞµÑ‚, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ÑÑ defaults
2. **ĞŸĞ¾ÑÑ‚ĞµĞ¿ĞµĞ½Ğ½Ğ¾Ğµ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ** - Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ disable AI selection ĞµÑĞ»Ğ¸ Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ°
3. **Fallback Ğ½Ğ° heuristic** - ĞµÑĞ»Ğ¸ AI selection fails, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ ÑĞ²Ñ€Ğ¸ÑÑ‚Ğ¸ĞºĞ°

### Migration guide:

```bash
# 1. Upgrade
npm install -g openrouter-commit@latest

# 2. Config Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¼ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ
orc commit

# 3. (ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾) ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´ ÑĞµĞ±Ñ
orc config:generation

# 4. (ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾) Disable AI selection ĞµÑĞ»Ğ¸ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑÑ‚Ğ°Ñ€Ğ¾Ğµ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ
orc config:generation set enableAIFileSelection false
```

---

## ğŸ“ Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ

### Phase 1: Critical Fixes âœ…
- [ ] Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ `.slice(0, 20)` Ğ¸Ğ· `core.ts:637`
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ `getAdaptiveLineLimit()` Ğ¼ĞµÑ‚Ğ¾Ğ´
- [ ] ĞŸĞ¾Ğ½Ğ¸Ğ·Ğ¸Ñ‚ÑŒ `relevancyThreshold` Ñ 0.1 Ğ´Ğ¾ 0.05
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ `quickFilter()` Ğ² `diff-filter.ts`
- [ ] Unit tests Ğ´Ğ»Ñ adaptive limits
- [ ] Integration test Ğ½Ğ° Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ°Ñ… ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ¾Ğ²

### Phase 2: AI File Selector âœ…
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ `src/modules/file-selector.ts`
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `AIFileSelector` ĞºĞ»Ğ°ÑÑ
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `quickFilter()`
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `createPreviews()`
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `askAI()` Ñ JSON Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ¾Ğ¼
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `heuristicSelection()` fallback
- [ ] Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² `core.ts`
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ `shouldUseAISelection()` Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ
- [ ] Unit tests Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ¾Ğ²
- [ ] Integration tests Ğ½Ğ° Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸ÑÑ…
- [ ] ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ¸ fallback

### Phase 3: Git Context âœ…
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ `getCommitHistory()` Ğ² `git.ts`
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ `getGitContextForAI()` Ğ¼ĞµÑ‚Ğ¾Ğ´
- [ ] Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² `generateCommitMessage()`
- [ ] Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ AI Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°
- [ ] Tests Ğ´Ğ»Ñ git context
- [ ] Fallback ĞµÑĞ»Ğ¸ git history Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°

### Phase 4: Configuration âœ…
- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ `types/index.ts` Ñ `CommitGenerationConfig`
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ defaults Ğ² `config.ts`
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `config:generation` CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹
- [ ] Migration existing configs
- [ ] Validation Ğ´Ğ»Ñ config values
- [ ] Documentation Ğ² README

### Phase 5: Testing âœ…
- [ ] Unit tests Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
- [ ] Integration tests Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸ĞµĞ²
- [ ] Performance benchmarks
- [ ] Cost analysis (token usage)
- [ ] Edge cases (huge commits, no git history, etc.)
- [ ] Backward compatibility tests

### Phase 6: Documentation & Release âœ…
- [ ] Update README.md
- [ ] Update CHANGELOG.md
- [ ] Create migration guide
- [ ] API documentation
- [ ] Example configurations
- [ ] Release notes

---

## ğŸš€ Timeline

**Week 1:**
- Days 1-2: Phase 1 (Critical Fixes)
- Days 3-4: Phase 2 (AI File Selector)
- Day 5: Phase 3 (Git Context)

**Week 2:**
- Days 1-2: Phase 4 (Configuration)
- Days 3-5: Phase 5 (Testing)
- Days 6-7: Phase 6 (Documentation & Release)

**Total:** ~2 weeks for complete implementation and testing

---

## ğŸ’° Cost-Benefit Analysis

### Costs:
- Development time: ~2 weeks
- Additional API costs: ~$0.002 per commit with AI selection
- Maintenance overhead: Minimal (new configuration options)

### Benefits:
- **Accuracy improvement:** ~80-90% (based on expected metrics)
- **User satisfaction:** Ğ—Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ²Ñ‹ÑˆĞµ (Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğµ commit messages)
- **Time saved:** ĞœĞµĞ½ÑŒÑˆĞµ manual editing commit messages
- **Code quality:** Ğ›ÑƒÑ‡ÑˆĞµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹
- **Adoption:** Ğ‘Ğ¾Ğ»ÑŒÑˆĞµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ´Ğ¾Ğ²ĞµÑ€ÑÑ‚ÑŒ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñƒ

### ROI:
```
Cost per commit: $0.001 (current) â†’ $0.003 (with AI selection)
Time saved per commit: ~30 seconds (no manual editing)
Value of developer time: ~$50/hour = $0.42 per minute

Savings: $0.42 Ã— 0.5 minutes = $0.21 per commit
Net benefit: $0.21 - $0.002 = $0.208 per commit

Break-even: Immediate (savings >> costs)
```

---

## ğŸ“š References

### Related Documents:
- `docs/CRITICAL_IMPROVEMENTS.md` - Original improvement ideas
- `docs/DEVELOPMENT.md` - Development guidelines
- `README.md` - User-facing documentation

### External Resources:
- [Conventional Commits](https://www.conventionalcommits.org/)
- [OpenRouter API Docs](https://openrouter.ai/docs)
- [Anthropic Claude API](https://docs.anthropic.com/)

---

## âœ… Success Criteria

ĞŸÑ€Ğ¾ĞµĞºÑ‚ ÑÑ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ÑÑ ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ğ¼ ĞºĞ¾Ğ³Ğ´Ğ°:

1. **ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ commit messages:**
   - âœ… AI Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğµ messages Ğ² 90%+ ÑĞ»ÑƒÑ‡Ğ°ĞµĞ²
   - âœ… ĞĞµÑ‚ Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ñ… "No relevant changes" Ğ´Ğ»Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ñ… ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ¾Ğ²
   - âœ… Large commits Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾

2. **Performance:**
   - âœ… Small commits: Ğ½Ğµ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½ĞµĞµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾
   - âœ… Medium commits: Ğ´Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ¼Ğ¾ +3-5 ÑĞµĞºÑƒĞ½Ğ´ Ğ·Ğ° accuracy
   - âœ… Large commits: Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ Ğ¸Ğ»Ğ¸ Ğ½Ğ° Ñ‚Ğ¾Ğ¼ Ğ¶Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ

3. **User Experience:**
   - âœ… ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
   - âœ… ĞŸĞ¾Ğ½ÑÑ‚Ğ½Ñ‹Ğµ error messages
   - âœ… Graceful fallbacks Ğ¿Ñ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°Ñ…
   - âœ… ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ

4. **Cost Efficiency:**
   - âœ… Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ costs Ğ¾Ğ¿Ñ€Ğ°Ğ²Ğ´Ğ°Ğ½Ñ‹ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸ĞµĞ¼ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ°
   - âœ… ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¼Ğ¾Ğ¶ĞµÑ‚ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ costs Ñ‡ĞµÑ€ĞµĞ· config
   - âœ… Fallback Ğ½Ğ° cheaper heuristic Ğ¿Ñ€Ğ¸ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸

---

**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** Ready for Implementation
**Next Steps:** Begin Phase 1 - Critical Fixes
**Owner:** Development Team
**Last Updated:** 2025-12-13
